"use strict";(self.webpackChunkpostman_docs=self.webpackChunkpostman_docs||[]).push([[103],{1588:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"scripting","title":"JavaScript Scripting\xa0: du basique au Ninja","description":"---------------------------","source":"@site/docs/07-scripting.md","sourceDirName":".","slug":"/scripting","permalink":"/postman-training/docs/scripting","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/07-scripting.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"JavaScript Scripting\xa0: du basique au Ninja","sidebar\\\\_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Authentification avanc\xe9e (Bearer, OAuth\xa02.0, Hawk, AWS\xa0SigV4)","permalink":"/postman-training/docs/auth-avancee"},"next":{"title":"Data\u2011Driven & Contract Testing","permalink":"/postman-training/docs/data-driven-contract"}}');var i=t(4848),r=t(8453);const a={title:"JavaScript Scripting\xa0: du basique au Ninja",sidebar_position:6},l=void 0,c={},d=[{value:"6.1\xa0Pourquoi scripter\xa0?",id:"61pourquoi-scripter",level:2},{value:"6.2\xa0\xc9cosyst\xe8me JavaScript Postman",id:"62\xe9cosyst\xe8me-javascript-postman",level:2},{value:"6.3\xa0Assertions basiques avec Chai",id:"63assertions-basiques-avec-chai",level:2},{value:"Pourquoi 1 assertion = 1 test\xa0?",id:"pourquoi-1-assertion--1-test",level:3},{value:"6.4\xa0Ajv\xa0+ JSON Schema \u2013 valider la structure",id:"64ajv-json-schema--valider-la-structure",level:2},{value:"6.5\xa0Retry exponentiel (pattern r\xe9silient)",id:"65retry-exponentiel-pattern-r\xe9silient",level:2},{value:"6.6\xa0Requ\xeates cha\xeen\xe9es (get\u2011then\u2011use)",id:"66requ\xeates-cha\xeen\xe9es-getthenuse",level:2},{value:"6.7\xa0Modules r\xe9utilisables",id:"67modules-r\xe9utilisables",level:2},{value:"6.12\xa0Check\u2011list Ninja ++",id:"612checklist-ninja-",level:2}];function o(e){const s={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"61pourquoi-scripter",children:"6.1\xa0Pourquoi scripter\xa0?"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Besoin"}),(0,i.jsx)(s.th,{children:"Sans script"}),(0,i.jsx)(s.th,{children:"Avec script Postman"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Changer un header dyn."}),(0,i.jsx)(s.td,{children:"\xc0 la main avant chaque envoi"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"pm.request.headers.add()"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Cha\xeener 2 appels"}),(0,i.jsx)(s.td,{children:"Plusieurs clics"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"pm.sendRequest()"})," dans Pre\u2011request"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"V\xe9rifier un sch\xe9ma"}),(0,i.jsx)(s.td,{children:"Lecture \u0153il humain"}),(0,i.jsx)(s.td,{children:"Ajv + test automatique"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Retry sur 500"}),(0,i.jsx)(s.td,{children:"Relancer manuellement"}),(0,i.jsxs)(s.td,{children:["Boucle ",(0,i.jsx)(s.code,{children:"while"})," + ",(0,i.jsx)(s.code,{children:"setTimeout"})]})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"62\xe9cosyst\xe8me-javascript-postman",children:"6.2\xa0\xc9cosyst\xe8me JavaScript Postman"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Lib dispo par d\xe9faut"}),(0,i.jsx)(s.th,{children:"Version"}),(0,i.jsx)(s.th,{children:"Exemple rapide"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Chai"})}),(0,i.jsx)(s.td,{children:"4.x"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"pm.expect(val).to.be.true;"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.strong,{children:"Lodash"})," (",(0,i.jsx)(s.code,{children:"_"}),")"]}),(0,i.jsx)(s.td,{children:"4.17"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"_.uniq([1,1,2])"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Moment"})}),(0,i.jsx)(s.td,{children:"2.x"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"moment().add(7,'days')"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"CryptoJS"})}),(0,i.jsx)(s.td,{children:"4.x"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"CryptoJS.HmacSHA256(msg,key)"})})]})]})]}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Tip"}),"\xa0: Postman Sandbox \u2248 Chromium\xa0; fonctions ES2021 (optional chaining, nullish coalescing) sont support\xe9es."]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"63assertions-basiques-avec-chai",children:"6.3\xa0Assertions basiques avec Chai"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:'pm.test("Statut 200", () => pm.response.to.have.status(200));\npm.test("Array non vide", () => {\n  pm.expect(pm.response.json().items).to.be.an("array").that.is.not.empty;\n});\n'})}),"\n",(0,i.jsx)(s.h3,{id:"pourquoi-1-assertion--1-test",children:"Pourquoi 1 assertion = 1 test\xa0?"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Localiser le bug plus vite."}),"\n",(0,i.jsx)(s.li,{children:"Rapport Newman clair (1 test = 1 ligne JUnit)."}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"64ajv-json-schema--valider-la-structure",children:"6.4\xa0Ajv\xa0+ JSON Schema \u2013 valider la structure"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:'import Ajv from "ajv";\nconst ajv = new Ajv({allErrors:true});\nconst schema = {\n  type:"object",\n  required:["id","email"],\n  properties:{\n    id:{type:"string",pattern:"^[0-9a-f-]{36}$"},\n    email:{type:"string",format:"email"}\n  }\n};\nconst data = pm.response.json();\npm.test("Sch\xe9ma valide", () => pm.expect(ajv.validate(schema,data)).to.be.true);\n'})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.em,{children:"Pourquoi\xa0?"}),"\xa0Pr\xe9vient les r\xe9gressions structurelles invisibles \xe0 l\u2019\u0153il nu."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"65retry-exponentiel-pattern-r\xe9silient",children:"6.5\xa0Retry exponentiel (pattern r\xe9silient)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:"const maxRetry = 3;\nconst retryKey = `retry_${pm.info.requestId}`;\nlet attempt = pm.variables.get(retryKey) || 0;\n\nif (pm.response.code >= 500 && attempt < maxRetry) {\n  attempt++;\n  pm.variables.set(retryKey, attempt);\n  const delay = 2 ** attempt * 100; // 200ms, 400ms, 800ms\n  setTimeout(() => postman.setNextRequest(pm.info.requestName), delay);\n} else {\n  pm.variables.unset(retryKey);\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.em,{children:"Pourquoi\xa0?"}),"\xa0Requ\xeates robustes face aux flaps r\xe9seau."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"66requ\xeates-cha\xeen\xe9es-getthenuse",children:"6.6\xa0Requ\xeates cha\xeen\xe9es (get\u2011then\u2011use)"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:'// Pre\u2011request \u2013 r\xe9cup ID utilisateur avant l\u2019appel principal\npm.sendRequest(`${pm.environment.get("baseUrl")}/users?email={{email}}`, (err,res) => {\n  pm.variables.set("userId", res.json().id);\n});\n'})}),"\n",(0,i.jsxs)(s.p,{children:["Dans l\u2019URL suivante\xa0: ",(0,i.jsx)(s.code,{children:"/orders/{{userId}}"}),"."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"67modules-r\xe9utilisables",children:"6.7\xa0Modules r\xe9utilisables"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Cr\xe9ez un fichier ",(0,i.jsx)(s.code,{children:"utils.js"}),"\xa0:"]}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:"exports.randomPwd = () => `Pw-${Math.random().toString(36).slice(2,10)}`;\n"})}),"\n",(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsxs)(s.li,{children:["Stockez le contenu minifi\xe9 dans ",(0,i.jsx)(s.code,{children:'pm.globals.set("lib_utils", <code>)'}),"."]}),"\n",(0,i.jsx)(s.li,{children:"Dans Pre\u2011request\xa0:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:'eval(pm.globals.get("lib_utils"));\npm.variables.set("pwd", exports.randomPwd());\n'})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.em,{children:"Pourquoi\xa0?"}),"\xa0Factoriser la logique, \xe9viter le copier\u2011coller."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"612checklist-ninja-",children:"6.12\xa0Check\u2011list Ninja ++"}),"\n",(0,i.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Assertions ",(0,i.jsx)(s.strong,{children:"Chai"})," distinctes (1 assertion\xa0=\xa01 test)."]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Validation ",(0,i.jsx)(s.strong,{children:"Ajv"})," du sch\xe9ma JSON."]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,i.jsx)(s.strong,{children:"Retry exponentiel"})," \u2264\xa03 tentatives."]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Variables ",(0,i.jsx)(s.strong,{children:"cha\xeen\xe9es"})," entre requ\xeates (",(0,i.jsx)(s.code,{children:"pm.sendRequest"}),")."]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,i.jsx)(s.strong,{children:"Utils.js"})," charg\xe9 via Globals / minifi\xe9."]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,i.jsx)(s.strong,{children:"Visualizer Chart.js"})," op\xe9rationnel (latence ou autre m\xe9trique)."]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,i.jsx)(s.strong,{children:"Pagination automatique"})," cursor/offset sans boucle infinie."]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,i.jsx)(s.strong,{children:"gRPC streaming"}),"\xa0: 10 messages re\xe7us et test\xe9s."]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,i.jsx)(s.strong,{children:"Agr\xe9gation des erreurs"})," Newman affich\xe9e en fin de run."]}),"\n"]}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["\ud83d\udc49 ",(0,i.jsx)(s.strong,{children:"Page suivante"}),"\xa0\u2013 Data\u2011Driven & Contract Testing\xa0: Runner CSV/JSON, Faker.js, rapports Newman / Postman CLI."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>a,x:()=>l});var n=t(6540);const i={},r=n.createContext(i);function a(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);