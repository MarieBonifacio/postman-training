"use strict";(self.webpackChunkpostman_docs=self.webpackChunkpostman_docs||[]).push([[516],{4639:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"auth-avancee","title":"Authentification avanc\xe9e (Bearer, OAuth\xa02.0, Hawk, AWS\xa0SigV4)","description":"------------------------","source":"@site/docs/06-auth-avancee.md","sourceDirName":".","slug":"/auth-avancee","permalink":"/postman-training/docs/auth-avancee","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/06-auth-avancee.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Authentification avanc\xe9e (Bearer, OAuth\xa02.0, Hawk, AWS\xa0SigV4)","sidebar\\\\_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Variables & Secrets Management","permalink":"/postman-training/docs/variables-secrets"},"next":{"title":"JavaScript Scripting\xa0: du basique au Ninja","permalink":"/postman-training/docs/scripting"}}');var t=n(4848),r=n(8453);const c={title:"Authentification avanc\xe9e (Bearer, OAuth\xa02.0, Hawk, AWS\xa0SigV4)",sidebar_position:5},l=void 0,d={},a=[{value:"5.1\xa0Bearer Token (JWT)",id:"51bearer-token-jwt",level:2},{value:"Pourquoi choisir Bearer\u202f?",id:"pourquoi-choisir-bearer",level:3},{value:"Mise en place Postman",id:"mise-en-place-postman",level:3},{value:"Script Pre\u2011request de rafra\xeechissement (client\u2011credentials)",id:"script-prerequest-de-rafra\xeechissement-clientcredentials",level:3},{value:"Check\u2011list Bearer",id:"checklist-bearer",level:4},{value:"5.2\xa0OAuth\xa02.0 \u2013 flux principaux",id:"52oauth20--flux-principaux",level:2},{value:"Assistant OAuth\xa02.0 de Postman",id:"assistant-oauth20-de-postman",level:3},{value:"Cas PKCE \u2013 Pourquoi\u202f?",id:"cas-pkce--pourquoi",level:3},{value:"Script Test pour v\xe9rifier les scopes",id:"script-test-pour-v\xe9rifier-les-scopes",level:4},{value:"Pi\xe8ges courants OAuth",id:"pi\xe8ges-courants-oauth",level:4},{value:"5.3\xa0Hawk HMAC (clock\u2011skew tolerant)",id:"53hawk-hmac-clockskew-tolerant",level:2},{value:"Pourquoi Hawk\u202f?",id:"pourquoi-hawk",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Test anti\u2011replay",id:"test-antireplay",level:4},{value:"5.4\xa0AWS Signature Version\xa04 (SigV4)",id:"54aws-signature-version4-sigv4",level:2},{value:"Pourquoi SigV4\u202f?",id:"pourquoi-sigv4",level:3},{value:"Pas\u2011\xe0\u2011pas Postman",id:"pas\xe0pas-postman",level:3},{value:"Script de test latence AWS",id:"script-de-test-latence-aws",level:4},{value:"Pi\xe8ges courants SigV4",id:"pi\xe8ges-courants-sigv4",level:4},{value:"5.5\xa0Comparatif rapide des sch\xe9mas",id:"55comparatif-rapide-des-sch\xe9mas",level:2},{value:"5.6\xa0Check\u2011list finale Auth",id:"56checklist-finale-auth",level:2}];function o(e){const s={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{id:"51bearer-token-jwt",children:"5.1\xa0Bearer Token (JWT)"}),"\n",(0,t.jsx)(s.h3,{id:"pourquoi-choisir-bearer",children:"Pourquoi choisir Bearer\u202f?"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Simplicit\xe9"})," : une seule cha\xeene base64 dans ",(0,t.jsx)(s.code,{children:"Authorization: Bearer <token>"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Stateless"})," : le serveur n\u2019a pas \xe0 stocker de session (si JWT auto\u2011contenu)."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"mise-en-place-postman",children:"Mise en place Postman"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Onglet ",(0,t.jsx)(s.strong,{children:"Auth \u25b8 Type \u25b8 Bearer Token"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["Collez ",(0,t.jsx)(s.code,{children:"{{access_token}}"})," comme valeur."]}),"\n",(0,t.jsx)(s.li,{children:"Sauvegardez la requ\xeate."}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"script-prerequest-de-rafra\xeechissement-clientcredentials",children:"Script Pre\u2011request de rafra\xeechissement (client\u2011credentials)"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'const exp = pm.environment.get("token_exp");\nif (!pm.environment.get("access_token") || Date.now() > exp) {\n  pm.sendRequest({\n    url: pm.environment.get("auth_url"),\n    method: "POST",\n    header: {"Content-Type": "application/json"},\n    body: {\n      mode: "raw",\n      raw: JSON.stringify({\n        client_id: pm.environment.get("client_id"),\n        client_secret: pm.environment.get("client_secret"),\n        audience: "api://backend",\n        grant_type: "client_credentials"\n      })\n    }\n  }, (err, res) => {\n    const json = res.json();\n    pm.environment.set("access_token", json.access_token);\n    pm.environment.set("token_exp", Date.now() + json.expires_in * 1000 - 60_000); // marge 1\xa0min\n  });\n}\n'})}),"\n",(0,t.jsx)(s.h4,{id:"checklist-bearer",children:"Check\u2011list Bearer"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Header ",(0,t.jsx)(s.code,{children:"Authorization"})," pr\xe9sent sur chaque requ\xeate."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Token d\xe9coule du script auto\u2011refresh."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","D\xe9codage rapide\xa0: ",(0,t.jsx)(s.code,{children:"console.log(JSON.parse(atob(token.split('.')[1])))"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"52oauth20--flux-principaux",children:"5.2\xa0OAuth\xa02.0 \u2013 flux principaux"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Flux"}),(0,t.jsx)(s.th,{children:"Cas d\u2019usage"}),(0,t.jsx)(s.th,{children:"Avantages"}),(0,t.jsx)(s.th,{children:"Limites"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.em,{children:"Client\u2011credentials"})}),(0,t.jsx)(s.td,{children:"Backend\u2011to\u2011Backend (machine)"}),(0,t.jsx)(s.td,{children:"Simplicit\xe9, pas de user consent"}),(0,t.jsx)(s.td,{children:"Pas de scopes utilisateurs"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.em,{children:"Authorization\u2011code"})," (+PKCE)"]}),(0,t.jsx)(s.td,{children:"Apps SPA / mobile"}),(0,t.jsx)(s.td,{children:"S\xfbr (secret\u2011less)"}),(0,t.jsx)(s.td,{children:"N\xe9cessite navigateur int\xe9gr\xe9 Postman"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.em,{children:"Refresh\xa0Token"})}),(0,t.jsx)(s.td,{children:"Renouvellement long terme"}),(0,t.jsx)(s.td,{children:"Persiste session"}),(0,t.jsx)(s.td,{children:"Stockage s\xe9curis\xe9 du refresh indispensable"})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"assistant-oauth20-de-postman",children:"Assistant OAuth\xa02.0 de Postman"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Onglet ",(0,t.jsx)(s.strong,{children:"Auth \u25b8 OAuth\xa02.0"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Configure New Token"}),"\u202f: remplir ",(0,t.jsx)(s.em,{children:"Auth URL"}),", ",(0,t.jsx)(s.em,{children:"Token URL"}),", ",(0,t.jsx)(s.em,{children:"Client\xa0ID"})," \u2026"]}),"\n",(0,t.jsxs)(s.li,{children:["Choisir ",(0,t.jsx)(s.strong,{children:"Grant Type"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["Postman ouvre un navigateur (flow ",(0,t.jsx)(s.em,{children:"auth\u2011code"}),") ou appelle la ",(0,t.jsx)(s.em,{children:"token URL"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"cas-pkce--pourquoi",children:"Cas PKCE \u2013 Pourquoi\u202f?"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.em,{children:"Elimine l\u2019usage d\u2019un client secret"}),"\u202f; id\xe9al pour front\u2011end public. Postman g\xe9n\xe8re le ",(0,t.jsx)(s.code,{children:"code_verifier"})," et ",(0,t.jsx)(s.code,{children:"code_challenge"}),"."]}),"\n",(0,t.jsx)(s.h4,{id:"script-test-pour-v\xe9rifier-les-scopes",children:"Script Test pour v\xe9rifier les scopes"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'const decoded = JSON.parse(atob(pm.environment.get("access_token").split(".")[1]));\npm.test("Scope orders:read pr\xe9sent", () => {\n  pm.expect(decoded.scope.split(" ")).to.include("orders:read");\n});\n'})}),"\n",(0,t.jsx)(s.h4,{id:"pi\xe8ges-courants-oauth",children:"Pi\xe8ges courants OAuth"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Probl\xe8me"}),(0,t.jsx)(s.th,{children:"Sympt\xf4me"}),(0,t.jsx)(s.th,{children:"Correctif"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Mauvais redirect_uri"}),(0,t.jsx)(s.td,{children:"Erreur 400 \xab\xa0Mismatching redirect\xa0\xbb"}),(0,t.jsx)(s.td,{children:"Copier la valeur exacte depuis Postman config"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Heure PC d\xe9cal\xe9e"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"invalid_grant"})}),(0,t.jsx)(s.td,{children:"Sync NTP, timezone correcte"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Port 443 bloqu\xe9"}),(0,t.jsx)(s.td,{children:"Timeout token URL"}),(0,t.jsx)(s.td,{children:"Ouvrir proxy/pare\u2011feu"})]})]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"53hawk-hmac-clockskew-tolerant",children:"5.3\xa0Hawk HMAC (clock\u2011skew tolerant)"}),"\n",(0,t.jsx)(s.h3,{id:"pourquoi-hawk",children:"Pourquoi Hawk\u202f?"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Protection ",(0,t.jsx)(s.strong,{children:"anti\u2011replay"})," : timestamp + nonce."]}),"\n",(0,t.jsx)(s.li,{children:"Pas de token \xe0 stocker, juste cl\xe9/secret (HMAC\u2011SHA\u2011256)."}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Onglet ",(0,t.jsx)(s.strong,{children:"Auth \u25b8 Hawk Authentication"})," (desktop agent requis)."]}),"\n",(0,t.jsxs)(s.li,{children:["Remplir ",(0,t.jsx)(s.code,{children:"Hawk ID"}),", ",(0,t.jsx)(s.code,{children:"Hawk Key"}),", ",(0,t.jsx)(s.code,{children:"Algorithm"}),"."]}),"\n",(0,t.jsx)(s.li,{children:"Postman signe automatiquement chaque requ\xeate."}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"test-antireplay",children:"Test anti\u2011replay"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'pm.test("R\xe9ponse MAC match", () => {\n  pm.expect(pm.response.headers.get("Server-Authorization")).to.exist;\n});\n'})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"54aws-signature-version4-sigv4",children:"5.4\xa0AWS Signature Version\xa04 (SigV4)"}),"\n",(0,t.jsx)(s.h3,{id:"pourquoi-sigv4",children:"Pourquoi SigV4\u202f?"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Obligatoire pour toutes les API\xa0Gateway s\xe9curis\xe9es, S3, etc."}),"\n",(0,t.jsx)(s.li,{children:"Signature canonique incluant date, r\xe9gion, service."}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"pas\xe0pas-postman",children:"Pas\u2011\xe0\u2011pas Postman"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Auth \u25b8 AWS Signature"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"AccessKey"}),", ",(0,t.jsx)(s.code,{children:"SecretKey"}),", ",(0,t.jsx)(s.code,{children:"AWS Region"}),", ",(0,t.jsx)(s.code,{children:"Service Name"})," (",(0,t.jsx)(s.code,{children:"execute-api"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:["Postman calcule la signature et ajoute headers ",(0,t.jsx)(s.code,{children:"Authorization"}),", ",(0,t.jsx)(s.code,{children:"x\u2011amz\u2011date"}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"script-de-test-latence-aws",children:"Script de test latence AWS"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'pm.test("Latency < 300\xa0ms", () => {\n  pm.expect(pm.response.responseTime).to.be.below(300);\n});\n'})}),"\n",(0,t.jsx)(s.h4,{id:"pi\xe8ges-courants-sigv4",children:"Pi\xe8ges courants SigV4"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Cause"}),(0,t.jsx)(s.th,{children:"Erreur AWS"}),(0,t.jsx)(s.th,{children:"Solution"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Horloge PC d\xe9cal\xe9e >5\u202fmin"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"RequestTimeTooSkewed"})}),(0,t.jsx)(s.td,{children:"Resync NTP"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Service Name erron\xe9"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"SignatureDoesNotMatch"})}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"execute-api"}),", ",(0,t.jsx)(s.code,{children:"s3"}),", etc."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Headers canonique oubli\xe9s"}),(0,t.jsx)(s.td,{children:"idem"}),(0,t.jsx)(s.td,{children:"Laisser Postman g\xe9rer 100\u202f% des headers"})]})]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"55comparatif-rapide-des-sch\xe9mas",children:"5.5\xa0Comparatif rapide des sch\xe9mas"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Crit\xe8re"}),(0,t.jsx)(s.th,{children:"Bearer"}),(0,t.jsx)(s.th,{children:"OAuth\xa02.0 PKCE"}),(0,t.jsx)(s.th,{children:"Hawk"}),(0,t.jsx)(s.th,{children:"AWS\xa0SigV4"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Cas d\u2019usage"})}),(0,t.jsx)(s.td,{children:"micro\u2011service interne"}),(0,t.jsx)(s.td,{children:"SPA mobile"}),(0,t.jsx)(s.td,{children:"API internes horodat\xe9es"}),(0,t.jsx)(s.td,{children:"Cloud AWS"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Complexit\xe9"})}),(0,t.jsx)(s.td,{children:"\u2605\u2606\u2606"}),(0,t.jsx)(s.td,{children:"\u2605\u2605\u2606"}),(0,t.jsx)(s.td,{children:"\u2605\u2605\u2606"}),(0,t.jsx)(s.td,{children:"\u2605\u2605\u2605"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Anti\u2011replay"})}),(0,t.jsx)(s.td,{children:"Non"}),(0,t.jsx)(s.td,{children:"Oui (state param)"}),(0,t.jsx)(s.td,{children:"Oui (nonce)"}),(0,t.jsx)(s.td,{children:"Oui (canonical req)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Expiration"})}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"exp"})," claim"]}),(0,t.jsx)(s.td,{children:"Refresh token"}),(0,t.jsx)(s.td,{children:"Timestamp \xb160\xa0s"}),(0,t.jsx)(s.td,{children:"15\xa0min par d\xe9faut"})]})]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"56checklist-finale-auth",children:"5.6\xa0Check\u2011list finale Auth"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Token Bearer auto\u2011refresh op\xe9rationnel."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Assistant OAuth\xa02.0 test\xe9 (PKCE ou client\u2011cred)."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Requ\xeates Hawk sign\xe9es sans erreur 401."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Requ\xeate SigV4 valid\xe9e (",(0,t.jsx)(s.code,{children:"200 OK"}),")."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Tests de scope, anti\u2011replay ou latence ajout\xe9s."]}),"\n"]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["\ud83d\udc49 ",(0,t.jsx)(s.strong,{children:"Page suivante"})," \u2013 JavaScript Scripting\xa0: du basique (",(0,t.jsx)(s.code,{children:"pm.test"}),") au Ninja (Ajv, Lodash, modules externes, retry backoff)."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>l});var i=n(6540);const t={},r=i.createContext(t);function c(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);