"use strict";(self.webpackChunkpostman_docs=self.webpackChunkpostman_docs||[]).push([[34],{4661:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"variables-secrets","title":"Variables & Secrets Management","description":"-----------------------------","source":"@site/docs/05-variables-secrets.md","sourceDirName":".","slug":"/variables-secrets","permalink":"/postman-training/docs/variables-secrets","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/05-variables-secrets.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Variables & Secrets Management","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Premi\xe8re requ\xeate HTTP & Collections","permalink":"/postman-training/docs/premiere-requete-collections"},"next":{"title":"Authentification avanc\xe9e (Bearer, OAuth\xa02.0, Hawk, AWS\xa0SigV4)","permalink":"/postman-training/docs/auth-avancee"}}');var t=n(4848),i=n(8453);const l={title:"Variables & Secrets Management",sidebar_position:4},c=void 0,d={},a=[{value:"4.1\xa0Pourquoi des variables\xa0?",id:"41pourquoi-des-variables",level:2},{value:"4.2\xa0Les quatre scopes et l\u2019algorithme de r\xe9solution",id:"42les-quatre-scopes-et-lalgorithme-de-r\xe9solution",level:2},{value:"Check\u2011list compr\xe9hension",id:"checklist-compr\xe9hension",level:3},{value:"4.3\xa0Cr\xe9er et basculer entre trois environnements",id:"43cr\xe9er-et-basculer-entre-trois-environnements",level:2},{value:"Script Pre\u2011request auto\u2011token",id:"script-prerequest-autotoken",level:3},{value:"4.4\xa0S\xe9curiser les secrets",id:"44s\xe9curiser-les-secrets",level:2},{value:"Masquage manuel via variable Convention",id:"masquage-manuel-via-variable-convention",level:3},{value:"Anti\u2011patterns secrets",id:"antipatterns-secrets",level:4},{value:"4.5\xa0Importer/Exporter des environnements \u2013 <em>Pourquoi versionner\xa0?</em>",id:"45importerexporter-des-environnements--pourquoi-versionner",level:2},{value:"4.6\xa0Visualizer rapide des variables",id:"46visualizer-rapide-des-variables",level:2},{value:"4.7\xa0Check\u2011list finale Variables &amp; Secrets",id:"47checklist-finale-variables--secrets",level:2}];function o(e){const s={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{id:"41pourquoi-des-variables",children:"4.1\xa0Pourquoi des variables\xa0?"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"R\xe9utilisabilit\xe9"}),"\xa0: changez une URL de base, toute votre collection suit."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"S\xe9curit\xe9"}),"\xa0: stockez les secrets hors du code et \xe9vitez de pousser des tokens dans Git."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Param\xe9trage"}),"\xa0: lancez la m\xeame collection contre ",(0,t.jsx)(s.code,{children:"staging"})," puis ",(0,t.jsx)(s.code,{children:"prod"})," sans modifier chaque requ\xeate."]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"42les-quatre-scopes-et-lalgorithme-de-r\xe9solution",children:"4.2\xa0Les quatre scopes et l\u2019algorithme de r\xe9solution"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Scope"}),(0,t.jsx)(s.th,{children:"Dur\xe9e de vie"}),(0,t.jsx)(s.th,{children:"Exemple typique"}),(0,t.jsx)(s.th,{children:"Priorit\xe9 de r\xe9solution"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Local"})}),(0,t.jsx)(s.td,{children:"Requ\xeate actuelle"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:'pm.variables.set("trace", $guid)'})}),(0,t.jsx)(s.td,{children:"1 (le plus haut)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Data"})}),(0,t.jsx)(s.td,{children:"Runner (CSV/JSON)"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"{{email}}"})," en data\u2011driven"]}),(0,t.jsx)(s.td,{children:"2"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Environment"})}),(0,t.jsx)(s.td,{children:"Workspace courant"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"{{baseUrl}}"}),", ",(0,t.jsx)(s.code,{children:"{{token}}"})]}),(0,t.jsx)(s.td,{children:"3"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Global"})}),(0,t.jsx)(s.td,{children:"Tous workspaces"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"{{company}}"}),", ",(0,t.jsx)(s.code,{children:"{{timezone}}"})]}),(0,t.jsx)(s.td,{children:"4"})]})]})]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Algorithme"}),"\xa0: Postman cherche ",(0,t.jsx)(s.code,{children:"Local \u2192 Data \u2192 Env \u2192 Global"}),". Si aucun scope ne contient la variable, elle reste litt\xe9rale."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"checklist-compr\xe9hension",children:"Check\u2011list compr\xe9hension"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Vous pouvez expliquer l\u2019ordre de r\xe9solution."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Vous utilisez ",(0,t.jsx)(s.code,{children:"Local"})," pour les valeurs \xe9ph\xe9m\xe8res (uuid)."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Vos secrets ne sont ",(0,t.jsx)(s.strong,{children:"pas"})," en Globals."]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"43cr\xe9er-et-basculer-entre-trois-environnements",children:"4.3\xa0Cr\xe9er et basculer entre trois environnements"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Environments \u25b8 +"})," \u2192 ",(0,t.jsx)(s.code,{children:"local"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Variables\xa0:"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Key"}),(0,t.jsx)(s.th,{children:"Initial\xa0Value"}),(0,t.jsx)(s.th,{children:"Current\xa0Value"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"baseUrl"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"http://localhost:8080"})}),(0,t.jsx)(s.td,{children:"\u2014"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"token"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"dev\u2011token\u2011123"})}),(0,t.jsx)(s.td,{children:"\u2014"})]})]})]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["R\xe9p\xe9tez pour ",(0,t.jsx)(s.strong,{children:"staging"})," et ",(0,t.jsx)(s.strong,{children:"prod"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["S\xe9lecteur en haut\u2011droite : choisissez ",(0,t.jsx)(s.code,{children:"staging"})," avant d\u2019envoyer une requ\xeate."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Pourquoi s\xe9parer Initial/Current\xa0?"})," ",(0,t.jsx)(s.code,{children:"Current"})," reste local \xe0 votre poste, ",(0,t.jsx)(s.code,{children:"Initial"})," est partag\xe9 quand vous exportez l\u2019environnement."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"script-prerequest-autotoken",children:"Script Pre\u2011request auto\u2011token"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'if (!pm.environment.get("token") || isExpired()) {\n  pm.sendRequest({\n    url: pm.environment.get("baseUrl") + "/auth",\n    method: "POST",\n    body: {\n      mode: "raw",\n      raw: JSON.stringify({ username: "qa", password: "qa" })\n    }\n  }, (err, res) => {\n    pm.environment.set("token", res.json().access_token);\n    pm.environment.set("token_exp", Date.now() + 50 * 60 * 1000);\n  });\n}\n'})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"44s\xe9curiser-les-secrets",children:"4.4\xa0S\xe9curiser les secrets"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"M\xe9thode"}),(0,t.jsx)(s.th,{children:"Plan Postman"}),(0,t.jsx)(s.th,{children:"Avantages"}),(0,t.jsx)(s.th,{children:"Limites"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.strong,{children:"Secure Variables"})," (v10+)"]}),(0,t.jsx)(s.td,{children:"Pro, Business"}),(0,t.jsx)(s.td,{children:"Chiffr\xe9es au repos, masqu\xe9es UI"}),(0,t.jsx)(s.td,{children:"Non exportables \u2194 CI difficile"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Postman Vault"})}),(0,t.jsx)(s.td,{children:"Business"}),(0,t.jsx)(s.td,{children:"Int\xe9gration HashiCorp/Azure Key\xa0Vault"}),(0,t.jsx)(s.td,{children:"Payant, Cloud only"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"CLI Secrets push"})}),(0,t.jsx)(s.td,{children:"Gratuit"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"postman vars push --env prod --from envfile"})}),(0,t.jsx)(s.td,{children:"Pas d\u2019UI, script requis"})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"masquage-manuel-via-variable-convention",children:"Masquage manuel via variable Convention"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'// Dans Pre\u2011request, cachez toute valeur commen\xe7ant par \xab\xa0secret_\xa0\xbb\nif (pm.request.url.toString().includes("secret_")) {\n  throw new Error("Secret leaked in URL\xa0!");\n}\n'})}),"\n",(0,t.jsx)(s.h4,{id:"antipatterns-secrets",children:"Anti\u2011patterns secrets"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Mauvaise pratique"}),(0,t.jsx)(s.th,{children:"Risque"}),(0,t.jsx)(s.th,{children:"Correction"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"token=abcd1234"})," en dur dans l\u2019URL"]}),(0,t.jsx)(s.td,{children:"Loggu\xe9 dans Proxy, Git"}),(0,t.jsxs)(s.td,{children:["Utiliser ",(0,t.jsx)(s.code,{children:"{{token}}"})," variable d\u2019Env"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsxs)(s.td,{children:["Token dans Tests (",(0,t.jsx)(s.code,{children:"console.log(token)"}),")"]}),(0,t.jsx)(s.td,{children:"Fuite Console export"}),(0,t.jsx)(s.td,{children:"Supprimer logs secrets"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsxs)(s.td,{children:["Commit d\u2019un fichier ",(0,t.jsx)(s.code,{children:".postman_environment"})," plein de secrets"]}),(0,t.jsx)(s.td,{children:"Stockage GitHub public"}),(0,t.jsxs)(s.td,{children:["Fichier ",(0,t.jsx)(s.code,{children:".gitignore"})," + Secure Vars"]})]})]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsxs)(s.h2,{id:"45importerexporter-des-environnements--pourquoi-versionner",children:["4.5\xa0Importer/Exporter des environnements \u2013 ",(0,t.jsx)(s.em,{children:"Pourquoi versionner\xa0?"})]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Audit"})," : savoir quand un endpoint de staging a chang\xe9."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Rollback"})," : revenir \xe0 un token pr\xe9c\xe9dent si nouveau scope invalide."]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'# Export JSON propret, sans Current Value\npostman export env "staging" --output envs/staging.postman_environment.json --no-current\n\ngit add envs/staging.postman_environment.json && git commit -m "chore(env): bump api version"\n'})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"46visualizer-rapide-des-variables",children:"4.6\xa0Visualizer rapide des variables"}),"\n",(0,t.jsx)(s.p,{children:"Ajoutez dans Tests\xa0:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'const table = Object.entries(pm.environment.toObject())\n  .map(([key, value]) => `<tr><td>${key}</td><td>${value}</td></tr>`)  \n  .join("");\npm.visualizer.set(`<table><tr><th>Var</th><th>Val</th></tr>${table}</table>`);\n'})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.em,{children:"Pourquoi\xa0?"})," Afficher \xe0 l\u2019\xe9cran les valeurs actives \xe9vite d\u2019envoyer un token vide."]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"47checklist-finale-variables--secrets",children:"4.7\xa0Check\u2011list finale Variables & Secrets"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Trois environnements ",(0,t.jsx)(s.code,{children:"local"}),", ",(0,t.jsx)(s.code,{children:"staging"}),", ",(0,t.jsx)(s.code,{children:"prod"})," cr\xe9\xe9s."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"baseUrl"}),", ",(0,t.jsx)(s.code,{children:"token"})," param\xe9tr\xe9s par env."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Script auto\u2011refresh token fonctionne (< 50\xa0minutes)."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Aucun secret en Global ou dans le code source."]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Exports JSON commit\xe9s ",(0,t.jsx)(s.strong,{children:"sans Current Value"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["\ud83d\udc49 ",(0,t.jsx)(s.strong,{children:"Page suivante"})," \u2013 Authentification avanc\xe9e (Bearer, OAuth\u202f2.0, Hawk, AWS SigV4)\xa0: comprendre les flux, scripts de refresh et tests de s\xe9curit\xe9."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>c});var r=n(6540);const t={},i=r.createContext(t);function l(e){const s=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);